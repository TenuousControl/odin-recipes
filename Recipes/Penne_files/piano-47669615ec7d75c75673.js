(()=>{var e={168:e=>{function t(e){this.message=e}t.prototype=new Error,t.prototype.name="InvalidCharacterError",e.exports="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var n=String(e).replace(/=+$/,"");if(n.length%4==1)throw new t("'atob' failed: The string to be decoded is not correctly encoded.");for(var a,r,o=0,i=0,d="";r=n.charAt(i++);~r&&(a=o%4?64*a+r:r,o++%4)?d+=String.fromCharCode(255&a>>(-2*o&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return d}},491:(e,t,n)=>{var a=n(168);e.exports=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(a(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return a(t)}}},489:(e,t,n)=>{"use strict";var a=n(491);function r(e){this.message=e}r.prototype=new Error,r.prototype.name="InvalidTokenError",e.exports=function(e,t){if("string"!=typeof e)throw new r("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(a(e.split(".")[n]))}catch(e){throw new r("Invalid token specified: "+e.message)}},e.exports.InvalidTokenError=r}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=function(e){try{return JSON.parse(e)}catch(e){}return null};const t={get:(e,t)=>(...n)=>{window.IM=window.IM||{},window.IM.logger=window.IM.logger||{queue:[]},e[t]&&e[t](...n),window.IM.logger.queue.push((()=>{const a=window.IM.logger.withName("piano");Object.assign(e,a),a[t](...n)}))}},a="undefined"==typeof Proxy?console:new Proxy({},t),r=()=>{var e,t,n,a;const r=(null===(e=window)||void 0===e||null===(t=e.navigator)||void 0===t||null===(n=t.userAgent)||void 0===n?void 0:n.toLowerCase())||"",{maxTouchPoints:o}=(null===(a=window)||void 0===a?void 0:a.navigator)||{};return r.includes("win")?"Windows":r.includes("android")?"Android":["iphone","ipad"].find((e=>r.includes(e)))?"iOS":r.includes("mac")?o&&o>2?"iOS":"macOS":null},o=e=>{"interactive"===document.readyState||"complete"===document.readyState?e():document.addEventListener("DOMContentLoaded",e)};var i=n(489),d=n.n(i),c=function(e){var t;try{t=d()(e)}catch(e){throw new Error("Failed to decode JWT token")}var n=t.exp,a=Math.floor(Date.now()/1e3);if(!n)throw new Error('Missing "exp" claim for JWT token');return n>a};const s=()=>{var e;return null===(e=document.cookie)||void 0===e?void 0:e.split(";").reduce(((e,t)=>{const[n,a]=t.trim().split("=");return e[n]=a,e}),{})},p=e=>{tp.push(["setExternalJWT",e]),a.debug("JWT sent to Piano",e)},u=e=>{const t=new URL(e,window.location.origin);t.searchParams.set("redirect",window.location.href),window.location.assign(t.href)},l=(e,t)=>{const n=window.history[e];window.history[e]=(...r)=>{const{pathname:o}=window.location,i=setInterval((()=>{const n=window.location.pathname;o!==n&&(a.debug("Route change detected",{previousPathname:o,newPathname:n,historyFunction:e,callback:t}),t(),clearInterval(i))}),500);n.apply(window.history,r)}},m=e=>{var t;(null===(t=performance)||void 0===t?void 0:t.mark)&&performance.mark(e)},w="piano_checkout_params",h=e=>(a.debug("loginRequired",{checkoutParams:e}),(e=>{const t=JSON.stringify(e);window.localStorage.setItem(w,t)})(e),u("/register"),!1),g=(e,t={})=>{window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:e,...t})},v=e=>"object"!=typeof e||null===e?e:Array.isArray(e)?e.map(v).filter(Boolean):Object.entries(e).reduce(((e,[t,n])=>null==n?e:"object"==typeof n?Array.isArray(n)?{...e,[t]:n.map(v).filter(Boolean)}:{...e,[t]:v(n)}:{...e,[t]:n}),{}),f=e=>{const{component:t="button",componentVariant:n,termId:r}=(null==e?void 0:e.params)||{},o={piano:{"data-feature":"Piano","data-component":t,"data-component-variant":n,"data-piano-term-id":r}};try{var i;const{experienceId:t,templateId:n,templateVariantId:a,displayMode:r}=JSON.parse((null==e||null===(i=e.params)||void 0===i?void 0:i.templateParams)||"{}");o.piano={...o.piano,"data-piano-experience-id":t,"data-piano-template-id":n,"data-piano-template-variant-id":a,"data-placement-variant":r}}catch(e){a.error("Unable to parse Piano template params object",e)}g("piano-cta-click",v(o));const d={"register-button":"/register","sign-in-link":"/signin"},{eventName:c}=e||{};Object.keys(d).includes(c)&&u(d[c])},y=({termId:e}={})=>{g("begin_checkout",{items:[{item_id:e}]})},b=({chargeAmount:e,chargeCurrency:t,promotionId:n,termId:a,uid:r}={})=>{const o=(()=>{const e=new Date;return`${String(e.getFullYear())}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")}${String(e.getHours()).padStart(2,"0")}${String(e.getMinutes()).padStart(2,"0")}`})().concat(null==r?void 0:r.slice(0,10));g("purchase",v({coupon:n,currency:t,transaction_id:o,value:e,items:[{item_id:a,coupon:n,currency:t,price:e}]}))},I=e=>{var t;if("close"===(null==e?void 0:e.state)&&((null===(t=tp.customVariables)||void 0===t?void 0:t.alreadyHasAccess)||g("abandon_checkout")),["checkoutCompleted","alreadyHasAccess"].includes(null==e?void 0:e.state)){const e=new URLSearchParams(window.location.search).get("redirectTo");if(!e)return void window.location.reload();window.location.assign(e)}},x=({term:{chargeAmount:e,chargeCurrency:t,originalBillingPlan:n,termId:a}}={term:{}})=>{const r=null==n?void 0:n.chargeAmount,o=r?Number((r-e).toFixed(2)):null;g("add_payment_info",v({currency:t,value:e,items:[{currency:t,discount:o,item_id:a,price:null!=r?r:e}]}))},k=e=>{"alreadyHasAccess"===(null==e?void 0:e.stateName)&&tp.push(["setCustomVariable","alreadyHasAccess",!0])},S=()=>{m("time-to-piano-initialised"),a.debug("init"),tp.experience.init(),(()=>{let e;try{e=JSON.parse(window.localStorage.getItem(w))}catch(e){a.error("Couldn't parse checkout params")}e&&(tp.pianoId.isUserValid()&&(a.debug("Resuming checkout with params: ",e),tp.offer.startCheckout(e)),window.localStorage.removeItem(w))})()};window.tp=window.tp||[],m("time-to-piano-loaded");const C=()=>{const t=function(t){return document.body&&t?((Array.isArray(t)?t:[t]).some((function(t){return n=function(t){var n=document.body.dataset[t];if(n)return e(n);var a="__".concat(t.trim().replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase(),"__"),r=document.getElementById(a);return r?e(r.innerHTML):null}(t),!!n})),n):null;var n}("pianoSettings")||{},{enabled:n,applicationId:o,production:i,customVariables:d=[],composerSiteId:u}=t;if(a.debug("Settings parsed",t),!n)return;const w={},g=()=>{Object.keys(w).forEach((e=>{a.debug("checkPianoExperienceReady",{state:w[e]});const{iframeReady:t,experienceId:n}=w[e];if(!t)return;const r=document.querySelector(`iframe[src*="${n}"]`);r?(a.debug(`iframe for ${n} found`,{iframe:r}),m("time-to-piano-experience"),((e,{containerSelector:t,displayMode:n,title:a,experienceId:r,templateId:o,variantId:i})=>{t&&e.setAttribute("data-placement",t),i&&e.setAttribute("data-piano-variant-id",i),e.setAttribute("data-feature","Piano"),e.setAttribute("data-piano-template-id",o),e.setAttribute("data-piano-experience-name",a),e.setAttribute("data-piano-experience-id",r),e.setAttribute("data-placement-variant",n)})(r,w[e]),(({title:e,experienceId:t,templateId:n,variantId:r})=>{window.LUX?(window.LUX.addData("piano-active","Yes"),window.LUX.addData("piano-title",e),window.LUX.addData("piano-experience",t),window.LUX.addData("piano-template",n),window.LUX.addData("piano-variant",r)):a.warn(`Could not add SpeedCurve LUX data as window.LUX is ${window.LUX}`)})(w[e])):a.debug(`Can't find the piano iframe for experience ID: ${n}`)}))};m("time-to-piano-started"),tp.push(["setDebug","debug"===localStorage.logLevel]),tp.push(["setAid",o]),tp.push(["setSandbox",!i]),tp.push(["setUseTinypassAccounts",!1]),tp.push(["setUsePianoIdUserProvider",!1]),tp.push(["setUsePianoIdLiteUserProvider",!0]),tp.push(["setCxenseSiteId",u]),d.push({key:"operatingSystem",value:r()}),((e=[])=>{e.forEach((({key:e,value:t})=>{"tags"===e?tp.push(["setTags",t]):tp.push(["setCustomVariable",e,t])}))})(d),(()=>{const{head:e}=document,t=document.createElement("script");t.src="//cdn.tinypass.com/api/tinypass.min.js",t.async=!0,e.appendChild(t)})(),new Promise((e=>{const{id_token:t}=s();t||e(),c(t)?(p(t),e()):new Promise((e=>{const t=new URL("/auth/refresh",window.location.href).href;a.debug("Attempting to refresh tokens so we can send JWT to Piano"),fetch(t).then((t=>{t.ok||(a.debug("Refresh authentication tokens was unsuccessful"),e(!1)),e(!0)})).catch((t=>{a.error(t),e(!1)}))})).then((t=>{t||e();const{id_token:n}=s();n&&c(n)&&p(n),e()}))})).then((()=>{var e;a.debug("adding handlers"),tp.push(["addHandler","loginRequired",h]),tp.push(["addHandler","checkoutClose",I]),tp.push(["addHandler","checkoutComplete",b]),tp.push(["addHandler","checkoutCustomEvent",f]),tp.push(["addHandler","checkoutStateChange",k]),tp.push(["addHandler","startCheckout",y]),tp.push(["addHandler","submitPayment",x]),tp.push(["init",S]),tp.push(["addHandler","showTemplate",e=>{a.debug("showTemplate",{templateObj:e});const{experienceId:t}=e;w[t]={...w[t],iframeReady:!0},g()}]),tp.push(["addHandler","showOffer",e=>{a.debug("showOffer",{offerObj:e});const{experienceId:t}=e;w[t]={...w[t],iframeReady:!0},g()}]),tp.push(["addHandler","experienceExecute",e=>{a.debug("experienceExecute",{expObj:e});const{events:t,experiences:n}=e.result;t.filter((e=>["showTemplate","showOffer"].includes(e.eventType))).forEach((e=>{const{experienceId:t}=e.eventExecutionContext,{containerSelector:r,displayMode:o,templateId:i,templateVariantId:d}=e.eventParams,c=n.find((e=>e.id===t)).title.split(" ").join("-").toLowerCase();a.debug("process experienceExecute",{event:e,experiences:n}),w[t]={...w[t],containerSelector:r,displayMode:o,title:c,experienceId:t,templateId:i,variantId:d}})),g()}]),l("pushState",e=()=>{var e;null===(e=window.tp.experience)||void 0===e||e.execute()}),l("replaceState",e)}))};((e,t=1)=>{if(!window.__tcfapi){const e=new Error("window.__tcfapi not found");a.error(e)}window.__tcfapi("addEventListener",2,((n,r)=>{if(r)["useractioncomplete","tcloaded"].includes(n.eventStatus)&&n.purpose.consents[t]&&(e(),window.__tcfapi("removeEventListener",2,(e=>{if(!e){const e=new Error("removeEventListener failure in TCFAPI");a.error(e)}}),n.listenerId));else{const e=new Error("addEventListener failure in TCFAPI");a.error(e)}}))})((()=>o(C))),o((()=>{const{head:e}=document,t=document.createElement("script");t.textContent='\n    document.cookie = "__adblocker=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";\n    var setNptTechAdblockerCookie = function(adblocker) {\n      var d = new Date();\n      d.setTime(d.getTime() + 60 * 5 * 1000);\n      document.cookie = "__adblocker=" + (adblocker ? "true" : "false") + "; expires=" + d.toUTCString() + "; path=/";\n    };\n    var script = document.createElement("script");\n    script.setAttribute("async", true);\n    script.setAttribute("src", "//www.npttech.com/advertising.js");\n    script.setAttribute("onerror", "setNptTechAdblockerCookie(true);");\n    document.getElementsByTagName("head")[0].appendChild(script);\n  ',e.appendChild(t)}))})()})();
//# sourceMappingURL=piano-47669615ec7d75c75673.js.map